<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DFS Worldwide | International Shipping Company & Freight Service</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/responsive.css">
  <link rel="shortcut icon" href="assets/images/favicon.png" type="image/x-icon">
  <style>
    body {
      background-image: none;
      color: #000;
    }

    .track-header {
      padding: 24px 0;
    }

    .badge-status {
      font-size: .9rem;
    }

    .td-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .td-card {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      overflow: hidden;
    }

    .td-card .head {
      display: flex;
    }

    .td-card .col {
      flex: 1;
      padding: 14px 16px;
      border-right: 1px solid #dee2e6;
    }

    .td-card .col:last-child {
      border-right: 0;
    }

    .td-card .label {
      color: #b02a37;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .td-card .value {
      font-size: 1.25rem;
      color: #000;
      padding-top: 4px;
    }

    .steps {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin: 24px 0 8px;
    }

    .steps .bar {
      position: absolute;
      top: 18px;
      left: 0;
      right: 0;
      height: 6px;
      background: #ced4da;
      z-index: 0;
      width: 95%;
      margin: 0 auto;
      overflow: hidden;
    }
    .steps .bar .runner{
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: #28a745;
      border-radius: 3px;
      animation: barGrow 2.4s linear infinite;
    }
    .steps .bar .runner:nth-child(2){ animation-delay: .7s; }
    .steps .bar .runner:nth-child(3){ animation-delay: 1.4s; }
    .steps .bar .fill{
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      background: #28a745;
      border-radius: 3px;
      transition: width .6s ease;
    }
    .steps.hold .bar .runner{ display: none; }
    .steps.hold .bar .fill{ background: #dc3545; }
    .steps.hold .step .icon{
      background: #dc3545;
      color: #fff;
      animation: blinkHold 1.2s ease-in-out infinite;
    }
    .progress-headline.hold{ color: #dc3545; }

    .step {
      position: relative;
      z-index: 1;
      text-align: center;
    }

    .step .icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #ced4da;
      margin-bottom: 6px;
    }

    .step.active .icon {
      background: #198754;
      color: #fff;
      animation: blinkActive 1.4s ease-in-out infinite;
    }

    .step.done .icon {
      background: green;
      color: #fff;
    }

    .step .label {
      font-size: .9rem;
      color: black;
    }

    .progress-headline {
      font-weight: 700;
      font-size: 1.5rem;
      color: #000;
      text-align: center;
      margin: 12px 0 20px;
    }

    .est {
      color: #000;
      margin-top: 18px;
      font-size: 14px;

    }

    .date {
      font-weight: 700;
      font-size: 20px;
      color: #000;
    }

    .td-table th {
      background: #f8f9fa;
    }

    .td-cta {
      text-align: right;
    }

    .icon-img {
      width: 20px;
      height: 20px;
      display: block;
      filter: none;
    }
    .step.active .icon .icon-img,
    .step.done .icon .icon-img { filter: invert(0) brightness(1); }

    @keyframes blinkActive {
      0%, 100% { background-color: #198754; }
      50% { background-color: #2abf70; }
    }
    @keyframes blinkHold {
      0%, 100% { background-color: #dc3545; }
      50% { background-color: #f87171; }
    }
    @keyframes barGrow {
      0%   { width: 0%;  opacity: 0; }
      10%  { width: 5%;  opacity: 1; }
      90%  { width: 33%; opacity: 1; }
      100% { width: 33%; opacity: 0; }
    }

    @media (max-width: 800px) {
         .steps .bar {
      width: 90%;
    }
  }
  </style>
</head>

<body>
<!-- header begins -->
<header>
  <div class="main_container">
      <div class="main_nav d-flex justify-content-between align-items-center">
          <div class="logo">
              <a href="./index.html">
                  <img src="assets/images/logo.png" alt="logo" class="img-fluid">
              </a>
          </div>
          <button class="menu_toggle" aria-label="Open menu" aria-expanded="false"
              aria-controls="primary-nav"><span></span><span></span><span></span></button>
          <nav id="primary-nav" class="nav d-flex align-items-center">
              <ul class="d-flex align-items-center">
                  <li><a class="nav_link" href="./index.html">Home</a></li>
                  <li><a class="nav_link" href="./about.html">About</a></li>
                  <li><a class="nav_link" href="#services">Services</a></li>
                  <li><a class="nav_link" href="#contact">Contact</a></li>
              </ul>
              <div>
                  <a href="#contact" class="cta nav_cta"> Get a Quote</a>
              </div>
          </nav>
      </div>

  </div>
</header>
<!-- header ends -->
  <div class="main_container track-header">
    <h1 class="h5 text-uppercase fw-bold mb-3">Tracking details</h1>
    <form id="trackSearch" class="row g-2">
      <div class="col-sm-8 col-md-6 col-lg-4">
        <input id="trackInput" class="form-control" placeholder="Enter tracking ID" required>
      </div>
      <div class="col-auto">
        <button class="btn" type="submit" style="background-color: #ffc107;">Search</button>
      </div>
    </form>
  </div>

  <div class="main_container" id="content">
    <div class="alert alert-info">Enter a tracking ID to view shipment details.</div>
  </div>

  <script>
    (function () {
      function getParam(name) {
        const u = new URL(window.location.href);
        return u.searchParams.get(name);
      }
      async function fetchTracking(tid) {
        const res = await fetch('/api/tracking-get?tid=' + encodeURIComponent(tid));
        return { ok: res.ok, data: await res.json() };
      }
      function render(tracking, stage) {
        const c = document.getElementById('content');
        const t = tracking || {};
        const s = stage || {};
        const ports = [t.port1, t.port2, t.port3, t.port4];
        const steps = [
          { key: 'picked_up', label: ports[0] || 'Port 1' },
          { key: 'out_for_delivery', label: ports[1] || 'Port 2' },
          { key: 'arrival_port', label: ports[2] || 'Port 3' },
          { key: 'delivered', label: ports[3] || 'Port 4' }
        ];
        const active = s.activeIndex || 0;
        const hold = s.hold || false;
        const progressPct = s.progressPct || 0;
        const statusHeadline = s.statusHeadline || 'In progress';
        const statusMessage = s.statusMessage || 'In progress';
        const estStr = t.delivery_date ? new Date(t.delivery_date).toDateString() : '—';
        const runnersHtml = (!hold && active < (steps.length - 1))
          ? ['0s', '.7s', '1.4s']
              .map((d) => `<span class="runner" style="left:${progressPct}%;animation-delay:${d}"></span>`)
              .join('')
          : '';

        c.innerHTML = `
        <div class="td-card mb-3">
          <div class="head">
            <div class="col">
              <div class="label">From:</div>
              <div class="value">${t.from_location || ''}</div>
            </div>
            <div class="col">
              <div class="label">To:</div>
              <div class="value">${t.to_location || ''}</div>
            </div>
          </div>
        </div>
        <div class="steps ${hold ? 'hold' : ''}">
          <div class="bar"><span class="fill" style="width:${progressPct}%"></span>${runnersHtml}</div>

          ${steps.map((s, i) => `
            <div class="step ${i < active ? 'done' : i === active ? 'active' : ''}">
              <div class="icon">
                <img src="assets/images/trackingicon_${i+1}.svg" alt="" class="icon-img">
              </div>
              <div class="label">${s.label}</div>
            </div>
          `).join('')}
        </div>
        <div class="progress-headline ${hold ? 'hold' : ''}">${statusHeadline}</div>
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table mb-0 td-table">
                <thead>
                  <tr>
                    <th class="w-25">Recipient Name</th>
                    <th class="w-25">Shipment Description</th>
                    <th class="w-25">Shipment Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>${t.recipient_name || '—'}</td>
                    <td>${t.shipment_description || '—'}</td>
                    <td>${statusMessage || '—'}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="d-flex align-items-center justify-content-between mt-3" style="padding-bottom: 40px;">
          <div class="">
            <div class="est">Estimated delivery</div>
            <div class="date">${estStr}</div>
          </div>
          <div class="col-md td-cta mt-3 mt-md-0">
            <a class="btn btn-outline-secondary" href="#">See more details</a>
          </div>
        </div>
      `;
      }
      
      async function load() {
        const input = document.getElementById('trackInput');
        const form = document.getElementById('trackSearch');
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          const v = input.value;
          window.location.search = '?tid=' + encodeURIComponent(v);
        });

        const tid = getParam('tid');
        if (!tid) return;
        input.value = tid;
        const { ok, data } = await fetchTracking(tid);
        const c = document.getElementById('content');
        if (!ok) {
          c.innerHTML = '<div class="alert alert-danger">Tracking ID not found.</div>';
          return;
        }
        render(data.tracking, data.stage);
        if (window.__trackInterval) clearInterval(window.__trackInterval);
        window.__trackInterval = setInterval(async () => {
          const { ok, data: refreshData } = await fetchTracking(tid);
          if (ok) render(refreshData.tracking, refreshData.stage);
        }, 30000);
      }

      load();
    })();
  </script>
  <script src="./assets/js/script.js"></script>
  <script src="./assets/js/animation.js"></script>
</body>

</html>